### Isolation Level

트랜잭션에서 일관성 없는 데이터를 허용하도록 하는 수준

### 필요성

데이터베이스는 ACID 특징과 같이 트랜잭션이 독립적인 수행을 하도록 한다.

- 원자성(Atomicity)
	트랜잭션이 DB에 모두 반영되거나, 혹은 전혀 반영되지 않아야 한다.
- 일관성(Consistency)
	트랜잭션의 작업 처리 결과는 항상 일관성 있어야 한다.
- 독립성(Isolation)
	둘 이상의 트랜잭션이 동시에 병행 실행되고 있을 때, 어떤 트랜잭션도 다른 트랜잭션 연산에 끼어들 수 없다.
- 지속성(Durability)
	트랜잭션이 성공적으로 완료되었으면, 결과는 영구적으로 반영되어야 한다.

따라서 Locking을 통해, 트랜잭션이 DB를 다루는 동안 다른 트랜잭션이 관여하지 못하도록 막는 것이 필요하다. 하지만 무조건 Locking으로 동시에 수행되는 수많은 트랜잭션을 순서대로 처리하는 방식으로 구현하게 되면 데이터 베이스의 성능은 떨어지게 될 것이다.
그렇다고 성능을 높이기 위해 Locking의 범위를 줄인다면 잘못 된 값이 처리 될 가능성이 생긴다. 따라서 효율적인 Locking 방법을 필요로 한다.

### 낮은 단계 Isolation Level을 활용할 때 발생하는 현상들

-  Dirty Read
	커밋되지 않은 수정중인 데이터를 다른 트랜잭션에서 읽을 수 있도록 허용할 때 발생하는 현상이다. 어떤 트랜잭션에서 아직 실행이 끝나지 않은 다른 트랜잭션에 의한 변경사항을 보게되는 경우

-  Non-Repeatable Read
	한 트랜잭션에서 같은 쿼리를 두 번 수행할 때 그 사이에 다른 트랜잭션 값을 수정 또는 삭제하면서 두 쿼리의 결과가 상이하게 나타나는 일관성이 깨진 현상

-  Phantom Read
	한 트랜잭션 안에서 일정 범위의 레코드를 두 번 이상 읽었을 때, 첫번째 쿼리에서 없던 레코드가 두번째 쿼리에서 나타나는 현상 트랜잭션 도중
	
### Isolation Level의 종류

1. Read Uncommitted (레벨 0)

> SELECT 문장이 수행되는 동안 해당 데이터에 Shared Lock이 걸리지 않는 계층

어떤 트랜잭션의 내용이 커밋(Commit)이나 롤백(Rollback)과 상관없이 다른 트랜잭션에서 조회가 가능합니다.

데이터의 일관성을 유지하는 것이 불가능해진다. `Dirty Read`가 발생합니다.

2. Read Committed (레벨 1)

> SELECT 문장이 수행되는 동안 해당 데이터에 Share Lock이 걸리는 계층

한 트랜잭션의 변경내용이 커밋(Commit)되어야만 다른 트랜잭션에서 조회가 가능합니다.

대부분의 SQL 서버가 Default로 사용하는 Isolation Level이다.

하지만 하나의 트랜잭션에서 똑같은 SELECT 쿼리를 실행했을 때는 항상 같은 결과를 가져와야 하는 `REPEATABLE READ`의 정합성에 어긋납니다. 즉, `Non-repeatable Read`이 발생합니다.

3. Repeatable Read (레벨 2)

> 트랜잭션이 완료될 때까지 SELECT 문장이 사용하는 모든 데이터에 Shared Lock이 걸리는 계층

자신보다 낮은 트랜잭션 번호를 갖는 트랜잭션에서 커밋한 데이터만 읽을 수 있다.

트랜잭션이 범위 내에서 조회한 데이터 내용이 항상 동일함을 보장한다.

MySQL에서 Default로 사용하는 Isolation Level. `Phantom Read`가 발생할 수 있습니다.

4. Serializable (레벨 3)

> 트랜잭션이 완료될 때 까지 SELECT 문장이 사용하는 모든 데이터에 Shared Lock이 걸리는 계층

가장 고수준의 격리수준으로 트랜잭션을 무조건 순차적으로 진행시킨다. 트랜잭션이 끼어들 수 없으니 데이터의 부정합 문제는 발생하지 않으나, 동시 처리가 불가능하여 처리 속도가 느려진다. 

 트랜잭션이 중간에 끼어들 수 없는 이유는 SELECT 쿼리 실행 시 Shared Lock(공유 잠금)을, INSERT, UPDATE, DELETE 쿼리 실행 시 Exclusive Lock (MySQL의 경우 Nexy Key Lock)을 걸어버리기 때문이다.

